---
title: Interop Contracts
description: Write smart contracts to test sending and verifying interop messages on ZKsync chains.
---

Before writing our contracts, clone the template repo that has the UI for the frontend already setup:

<!-- // cspell: disable -->
```bash
git clone https://github.com/sarahschwartz/interop-messages-defi-demo.git
cd interop-messages-defi-demo
```
<!-- // cspell: enable -->

Create another folder called `contracts` and move inside this folder:

```bash
mkdir contracts
cd contracts
```

Initialize a new hardhat project in the `contracts` folder:

```bash
npx hardhat --init
```

Select the option to use `hardhat-3` with `typescript` and `mocha-ethers`.
Select yes to install the default dependencies.

Once the project is initialized,
you can delete the template files in the `contracts`, `ignition/modules`, `scripts`, and `tests` folders.

To make the interop script more straightforward,
we can use the `zksync-ethers` and `zksync-contracts` SDKs.

Inside the hardhat project, run the command below to install these dependencies:

::code-group

```bash [npm]
npm install -D zksync-ethers @matterlabs/zksync-contracts
```

```bash [yarn]
yarn add -D zksync-ethers @matterlabs/zksync-contracts
```

```bash [pnpm]
pnpm add -D zksync-ethers @matterlabs/zksync-contracts
```

```bash [bun]
bun add -D zksync-ethers @matterlabs/zksync-contracts
```

::

## Hardhat config

Next, update the `hardhat.config.ts` file to configure our local networks

```ts [hardhat.config.ts]
:code-import{filePath="interop-messages/contracts/hardhat.config.ts"}
```

## Staking contract

Create a new file in the `contracts/contracts` folder called `Staking.sol`.

```bash
touch contracts/Staking.sol
```

Then copy and paste the staking contract:

```solidity [Staking.sol]
:code-import{filePath="interop-messages/contracts/contracts/Staking.sol"}
```

There are two functions in the staking contract: `deposit` and `withdraw`.

When a user first calls the `deposit` method, the contract sends an interop message with their encoded address.
To send the message, we use the `sendToL1` function on the `L1Messenger` contract, which is pre-deployed on every ZKsync chain at address `0x00..008008`.

The `withdraw` method simply refunds the user their deposited funds.

## Token contract

Create a new file in the `contracts/contracts` folder called `InteropToken.sol`.

```bash
touch contracts/InteropToken.sol
```

Then copy and paste the token contract:

```solidity [InteropToken.sol]
:code-import{filePath="interop-messages/contracts/contracts/InteropToken.sol"}
```

In the token contract's constructor function, a list of approved staking contract addresses and their chain IDs must be defined.

This contract has a mint function that takes the arguments needed for message verification.
We use the `proveL2MessageInclusionShared` method in the L2 message verification contract for verification.
This contract is deployed at `0x..10009` on each ZKsync chain.

Users can only call the mint function once.
The mint function requires that the user previously deposited some amount on one of the approved staking contracts.

## Ignition scripts

Now that we have the contracts ready, let's add some ignition scripts for deploying.

### Staking ignition script

Create a new file in the `ignition/modules` folder called `Staking.ts`:

```bash
touch ignition/modules/Staking.ts
```

Then copy and paste the module below:

```ts [ignition/modules/Staking.ts]
:code-import{filePath="interop-messages/contracts/ignition/modules/Staking.ts"}
```

### Token ignition script

Create another file in the `ignition/modules` folder called `InteropToken.ts`:

```bash
touch ignition/modules/InteropToken.ts
```

Then copy and paste the module below:

```ts [ignition/modules/InteropToken.ts]
:code-import{filePath="interop-messages/contracts/ignition/modules/InteropToken.ts"}
```

## Deploying the contracts

Add some scripts to `package.json` to make it easier to compile and deploy the contracts:

```json [package.json]
"scripts": {
  "compile": "hardhat compile",
  "deploy:staking": "hardhat ignition deploy ignition/modules/Staking.ts",
  "deploy:token": "hardhat ignition deploy ignition/modules/InteropToken.ts --network rewardsChain",
},
```

Now you can compile the contracts with:

::code-group

```bash [npm]
npm run compile
```

```bash [yarn]
yarn compile
```

```bash [pnpm]
pnpm compile
```

```bash [bun]
bun compile
```

::

Then deploy the staking contract to the staking chains:

::code-group

```bash [npm]
npm run deploy:staking --network stakingChain1
```

```bash [yarn]
yarn deploy:staking --network stakingChain1
```

```bash [pnpm]
pnpm deploy:staking --network stakingChain1
```

```bash [bun]
bun deploy:staking --network stakingChain1
```

::

::code-group

```bash [npm]
npm run deploy:staking --network stakingChain2
```

```bash [yarn]
yarn deploy:staking --network stakingChain2
```

```bash [pnpm]
pnpm deploy:staking --network stakingChain2
```

```bash [bun]
bun deploy:staking --network stakingChain2
```

::

### Deploy the Token Contract

Update the approved staking contract addresses and check chain IDs in the `ignition/modules/InteropToken.ts` file.

Then deploy the `InteropToken` contract:

::code-group

```bash [npm]
npm run deploy:token
```

```bash [yarn]
yarn deploy:token
```

```bash [pnpm]
pnpm deploy:token
```

```bash [bun]
bun deploy:token
```

::

Now that we have all the contracts deployed, we can integrate them in the next section.
