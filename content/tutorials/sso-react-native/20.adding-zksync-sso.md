---
title: Adding ZKsync SSO
description: Complete your mobile payment app with ZKsync SSO integration
---

Right now the app is just missing ZKsync SSO integration.
Let's add that.

## Installation

Use `expo` to install the `react-native-zksync-sso` package:

```bash
npx expo install react-native-zksync-sso
```

## Configuration File

The configuration file is used to define what ZKsync SSO contracts will be called during account creation and authentication.
For this example, we will use the ZKsync SSO contracts deployed on ZKsync Era Sepolia testnet.
If you want to use a different deployment of the SSO contracts,
this is where you can configure those values.

In the config, there is also a private key required that represents the wallet that will deploy accounts.
Make sure the account has some testnet ETH on ZKsync Era Sepolia testnet.

Do not include the `0x` prefix in the private key.
Do not publicly commit this file with a real private key,
or use this file in production.
In a production app, the private key should be securely located in a private backend server.
This will explained in more detail in the [passkey creation](#passkey-creation) section.

```ts
:code-import{filePath="sso-react-native/utils/loadConfig.ts"}
```

## Account Types

There are a few types missing from the `types/types.ts` that our app needs.
Edit the `types/types.ts` file to add types for the SSO account:

```ts
:code-import{filePath="sso-react-native/types/types.ts"}
```

## RpId

The RpId is short for the [relaying party ID](https://webauthn.wtf/how-it-works/relying-party),
a key component of passkeys.
It represents entity whose application is registering and authenticating users.
This value ties the passkey created to your domain.
You can use the same domain and RpId for different applications,
so the same passkey works on all of the applications.

Copy/paste the code below into your `app/index.tsx` file,
and modify the input string for the `createRpId` function so it matches your domain.
For iOS, you only need to modify the first input value.
The second value is only used for Android.

```ts
import sdk from 'react-native-zksync-sso';

const rpId = sdk.utils.createRpId(
  // The RpId maps to the domain only, not the full App ID
  // ex: for the App ID dev.zksync.auth-test.SSOTutorialDemoRN
  "auth-test.zksync.dev", // RP ID (same for both platforms)
  "android:apk-key-hash:-sYXRdwJA3hvue3mKpYrOZ9zSPC7b4mbgzJmdZEDO5w" // Android origin
);
```

Then add the prop to the `MainView` component:

```jsx
<MainView rpId={rpId} />
```

## Account Info

In the `MainView` component,
add variables for the `accountName` and `accountUserID`.
Both of these values should be strings.

Note that the `accountName` is what will show as the display name for the passkey when the user is prompted to sign a transaction.
The purpose of the `accountUserID` is explained in the [passkey creation](#passkey-creation) section.

```ts
const accountName = 'Zeek';
const accountUserID = 'zeekUserId';
```

## Account Client

The account client is what we will use to send transactions.
Add a new folder in the `utils` folder called `authenticate`.

### `accountClient.ts`

Create a new file called `accountClient.ts` in the `utils/authenticate` folder.
Paste the code below:

```ts
:code-import{filePath="sso-react-native/utils/authenticate/accountClient.ts"}
```

There are two functions in the `AccountClient` class:

1. `prepareSendTransaction`: prepares the full transaction details of a transaction in case you want to display those.
1. `sendTransaction`: sends transactions and awaits for them to be confirmed.

### `authenticator.ts`

Create another file in the `utils/authenticate` folder called `authenticator.ts`.

Paste the code below:

```ts
:code-import{filePath="sso-react-native/utils/authenticate/authenticator.ts"}
```

The `Authenticator` class just has one method called `signMessage`.
This method is what calls the device platform's passkey authentication
when a user is prompted to sign a transaction.

## Account Utils

Add a new file called `account.ts` in the `utils` folder.
This file will have several functions related to the user's account.

Let's start by adding some imports we'll need:

```ts
:code-import{filePath="sso-react-native/utils/account.ts:imports"}
```

### Passkey Creation

The first function we will add to the account utils will be `createPasskey`.
This function creates a new passkey and generates a new wallet in three steps:

1. Generates a random challenge (i.e. message) for the passkey to sign.
1. Prepares the RpId for the passkey to be associated with.
1. Registers the passkey and account with `registerAccountWithUniqueId`.

```ts
:code-import{filePath="sso-react-native/utils/account.ts:createPasskey"}
```

#### Registration Options

There are two methods available to create a new wallet and passkey: `registerAccount` and `registerAccountWithUniqueId`.

- `registerAccount` creates a random wallet address.
- `registerAccountWithUniqueId` creates a deterministic wallet address based on the deploy wallet private key and the user ID.

For web3 native applications, generally `registerAccount` is recommended.
In this case, only the account address must be stored somewhere.
The account address cannot be derived in any way.

For web2 applications that already have a username or email used to login,
`registerAccountWithUniqueId` can be used to create an address based on that account info.
Because the method also relies on a private key from the ZKsync SSO config,
this method should be called from a private backend server.
In this case, the address can be derived from the userID.

For this example, however, we will be using `registerAccountWithUniqueId` without a backend server to demonstrate how that works.
This will allow us to derive the account details for testing purposes without storing them directly.

Note that because both values that determine the address are hardcoded here
(the private key in the config and the account user ID),
**this will generate the same address for all users**.

::callout{icon="i-heroicons-exclamation-triangle" color="amber"}
DO NOT use this exact implementation in production!
::

### Deriving the Account

Next, let's add a function called `getAccountByUserIdWrapper`.
This function will use the configuration file and user ID to derive the user's account details.

```ts
:code-import{filePath="sso-react-native/utils/account.ts:getAccountByUserIdWrapper"}
```

### Account Balance

Add another function called `loadBalance` to streamline fetching the user's ETH balance.

```ts
:code-import{filePath="sso-react-native/utils/account.ts:loadBalance"}
```

### Account Details

Finally, add a function called `createAccountDetails` which we can use to create an `AccountDetails` object.
This will help to easily display information for the account.

```ts
:code-import{filePath="sso-react-native/utils/account.ts:createAccountDetails"}
```

## Mock Data

In the `utils/mockData.ts` file is used to populate the friends list.
Edit at least one of these addresses with an address that you control.

### Send Transaction

The last file we need to add is the `sendETH.ts` file in the `utils` folder.
This is where the `sendETHWithSSO` function is implemented.

Paste the code below.

```ts
:code-import{filePath="sso-react-native/utils/sendETH.ts"}
```

In this function, a new account client is created,
which is used to send an ETH transfer transaction.
If you wanted to send ERC20 tokens instead,
you could modify the `transaction` here to do that.

## Running the app

Now the app is ready to build and test!
Plug in your device, unlock it and select to trust your computer when prompted.
Use the command below to build a development build of the app:

```bash
npm run ios:device
```

Select your device.
This will take a minute or two.
If you can see your app running and the sign in screen, great!
If you just see the Expo splash screen,
stop the Expo server.
Then run:

```bash
npm run start
```

Use the QR code in the console to open the development build.
Now you should be able to test the development build on your device!

### Testing the app

Start by creating a new account and passkey.
Once signed in, go to your wallet tab, and hold down your account address to copy it.
Now you can use this to send the account some testnet ETH from your regular wallet.
Press the "Refresh" button to refresh your wallet balance.

Now, you can try sending some ETH to one of your friends.
Once sent, you should see the transaction appear on the index tab.
You can also try sending a transaction from one of the friend accounts.

Remember that if you want to try creating another new account and passkey,
you must either change the user ID or the deployer private key in the `utils/loadConfig.ts` file.

::twitter-button{text="Just built a mobile app on @zkSyncDevs that lets users sign transactions with Face ID!"}
