---
title: Ecosystem Setup
description: Setup a multichain ecosystem to test interop messages.
---

Before writing any code, we will setup a local ecosystem for testing.

Alternatively, if you want to use live testnets that settle on ZKsync Gateway instead of a local setup,
check out the testnets that use ZKsync Gateway in the docs [chains list](https://docs.zksync.io/zksync-network/environment),
get some testnet funds for each chain you want to use (at least three recommended),
and continue to the next section.
Note: Although Lens testnet does use ZKsync Gateway, it uses a staging version that is not interoperable with other testnets.

The benefit of using a local ecosystem is that transaction finalization is much faster, and you don't need to get testnet funds from a faucet.

The benefit of using live testnets is that you can skip the steps on this page,
and run the project on lighter hardware.

## Prerequisites

- Install the dependencies for the `zksync-era` repo by following the instructions in the [setup dev guide](https://github.com/matter-labs/zksync-era/blob/main/docs/src/guides/setup-dev.md).
- Upgrade or install your version of [`node`](https://nodejs.org/) to at least `22.10.0` as required by the latest version of Hardhat.

## Setup

### Install the latest version of `zkstack` CLI

```bash
cargo install --git https://github.com/matter-labs/zksync-era/ --locked zkstack --force
```

```bash
zkstackup
```

### Update `zksync-foundry`

Update `foundry-zksync` to use the version from commit `27360d4c8`:

<!-- // cspell: disable -->
```bash
foundryup-zksync -C 27360d4c8
```
<!-- // cspell: enable -->

### Create a new ecosystem

Before starting the containers, make sure Docker is already running.

```bash
zkstack ecosystem create
```

You will be prompted with a series of options to customize your ecosystem and generate a new chain within the ecosystem.
For this tutorial, use the options shown below.

```bash
❯ zkstack ecosystem create

┌   ZK Stack CLI
│
◇  What do you want to name the ecosystem?
│  interop_ecosystem
│
◇  Select the origin of zksync-era repository
│  Clone for me (recommended)
│
◇  Select the L1 network
│  Localhost
│
◇  What do you want to name the chain?
│  zk_chain_1
│
◇  What's the chain id?
│  34234
│
◇  Select how do you want to create the wallet
│  Localhost
│
◇  Select the prover mode
│  NoProofs
│
◇  Select the commit data generator mode
│  Rollup
│
◇  Select the base token to use
│  Eth
│
◇  Enable EVM emulator?
│  Yes
│
◇  Do you want to start containers after creating the ecosystem?
│  Yes
```

### Initialize the Ecosystem and Your First Chain

Move into your ecosystem folder and initialize the ecosystem and your first chain:

```bash
cd interop_ecosystem
zkstack ecosystem init --dev
```

This step can take several minutes to complete.

### Create & Init Gateway Chain

Now that you have an ecosystem and chain setup for testing,
use the commands below to add another chain to act as the ZKsync Gateway.

```bash
zkstack chain create \
    --chain-name gateway \
    --chain-id 506 \
    --prover-mode no-proofs \
    --wallet-creation localhost \
    --l1-batch-commit-data-generator-mode rollup \
    --base-token-address 0x0000000000000000000000000000000000000001 \
    --base-token-price-nominator 1 \
    --base-token-price-denominator 1 \
    --set-as-default false \
    --evm-emulator false \
    --ignore-prerequisites --update-submodules false 
```

```bash
zkstack chain init \
  --deploy-paymaster \
  --l1-rpc-url=http://localhost:8545 \
  --server-db-url=postgres://postgres:notsecurepassword@localhost:5432 \
  --server-db-name=zksync_server_localhost_gateway \
  --chain gateway --update-submodules false
```

### Setup the transaction filterer

Next, setup the transaction filterer for gateway:

```bash
zkstack chain gateway create-tx-filterer --chain gateway --ignore-prerequisites
```

### Convert gateway chain to gateway mode

With the gateway chain setup, the next step is to convert the gateway chain to act as ZKsync gateway.

```bash
zkstack chain gateway convert-to-gateway --chain gateway --ignore-prerequisites
```

### Start the gateway server

Next, start the server for gateway and keep it running.

```bash
zkstack server --ignore-prerequisites --chain gateway
```

### Create & Init a Two More Chains

We will create two more chains for the app.
Open a new terminal in the same ecosystem folder,
and use the commands below to create and initialize two more chains.

#### `zk_chain_2`

```bash
zkstack chain create \
    --chain-name zk_chain_2 \
    --chain-id 5328 \
    --prover-mode no-proofs \
    --wallet-creation localhost \
    --l1-batch-commit-data-generator-mode rollup \
    --base-token-address 0x0000000000000000000000000000000000000001 \
    --base-token-price-nominator 1 \
    --base-token-price-denominator 1 \
    --set-as-default false \
    --evm-emulator true \
    --ignore-prerequisites --update-submodules false 
```

```bash
zkstack chain init \
    --deploy-paymaster \
    --l1-rpc-url=http://localhost:8545 \
    --server-db-url=postgres://postgres:notsecurepassword@localhost:5432 \
    --server-db-name=zksync_server_localhost_zk_chain_2 \
    --chain zk_chain_2 \
    --update-submodules false
```

#### `zk_chain_3`

```bash
zkstack chain create \
    --chain-name zk_chain_3 \
    --chain-id 37427 \
    --prover-mode no-proofs \
    --wallet-creation localhost \
    --l1-batch-commit-data-generator-mode rollup \
    --base-token-address 0x0000000000000000000000000000000000000001 \
    --base-token-price-nominator 1 \
    --base-token-price-denominator 1 \
    --set-as-default false \
    --evm-emulator true \
    --ignore-prerequisites --update-submodules false 
```

```bash
zkstack chain init \
    --deploy-paymaster \
    --l1-rpc-url=http://localhost:8545 \
    --server-db-url=postgres://postgres:notsecurepassword@localhost:5432 \
    --server-db-name=zksync_server_localhost_zk_chain_3 \
    --chain zk_chain_3 \
    --update-submodules false
```

### Migrate the Chains to Gateway

The next step is to migrate the three chains we have to settle via gateway.
Without this step, these chains are unable to utilize interop.
Run the commands below to do the migration.

```bash
zkstack chain gateway migrate-to-gateway --chain zk_chain_1 --gateway-chain-name gateway --ignore-prerequisites
```

```bash
zkstack chain gateway migrate-to-gateway --chain zk_chain_2 --gateway-chain-name gateway --ignore-prerequisites
```

```bash
zkstack chain gateway migrate-to-gateway --chain zk_chain_3 --gateway-chain-name gateway --ignore-prerequisites
```

### Start the Other Chain Servers

Now that the chains are using gateway, you can start the rest of the servers.
Start the first server for `zk_chain_1` with:

```bash
zkstack server --ignore-prerequisites --chain zk_chain_1
```

Then, open another terminal in the ecosystem folder and start the second chain's server:

```bash
zkstack server --ignore-prerequisites --chain zk_chain_2
```

Open another terminal to start the last chain's server:

```bash
zkstack server --ignore-prerequisites --chain zk_chain_3
```

### Bridge Funds

The last step needed to finish the ecosystem setup is to bridge some funds over to an account on each chain except Gateway.
The command uses a pre-configured rich wallet to bridge 1 ETH to `0x36615cf349d7f6344891b1e7ca7c72883f5dc049`.
Open a new terminal in the ecosystem folder, and run:

```bash
zkstack dev rich-account --chain zk_chain_1
```

```bash
zkstack dev rich-account --chain zk_chain_2
```

```bash
zkstack dev rich-account --chain zk_chain_3
```

Now that the ecosystem is all setup,
we will move on to writing our contracts.
