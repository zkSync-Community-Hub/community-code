---
title: Interop Contracts
description: Write smart contracts to test sending and verifying interop messages on ZKsync chains.
---

Before writing our contracts, clone the template repo that has the UI for the frontend already setup:

<!-- // cspell: disable -->
```bash
git clone https://github.com/sarahschwartz/interop-messages-defi-demo.git
cd interop-messages-defi-demo
```
<!-- // cspell: enable -->

Create another folder called `contracts` and move inside this folder:

```bash
mkdir contracts
cd contracts
```

Initialize a new hardhat project in the `contracts` folder:

```bash
npx hardhat --init
```

Select the options to use `Hardhat 3` and a
`TypeScript` project using `Mocha and Ethers.js`.
Select yes to install all of the default dependencies.

Once the project is initialized,
you can delete the template files in the `contracts`, `ignition/modules`, `scripts`, and `tests` folders.

```bash
rm -rf ./contracts/*
rm -rf ./ignition/modules/*
rm -rf ./scripts/*
rm -rf ./test/*
```

To make the interop script more straightforward,
we can use the `zksync-ethers` and `zksync-contracts` SDKs.

Inside the hardhat project, run the command below to install these dependencies:

::code-group

```bash [npm]
npm install -D zksync-ethers @matterlabs/zksync-contracts
```

```bash [yarn]
yarn add -D zksync-ethers @matterlabs/zksync-contracts
```

```bash [pnpm]
pnpm add -D zksync-ethers @matterlabs/zksync-contracts
```

```bash [bun]
bun add -D zksync-ethers @matterlabs/zksync-contracts
```

::

## Hardhat config

Next, update the `hardhat.config.ts` file to configure our local networks

```ts [hardhat.config.ts]
:code-import{filePath="interop-messages/contracts/hardhat.config.ts"}
```

For each chain we are using `configVariable('WALLET_PRIVATE_KEY')` for the deployer account.

To configure this using Hardhat keystore,
run the command below:

::code-group

```bash [npm]
npx hardhat keystore set WALLET_PRIVATE_KEY
```

```bash [yarn]
yarn hardhat keystore set WALLET_PRIVATE_KEY
```

```bash [pnpm]
pnpm hardhat keystore set WALLET_PRIVATE_KEY
```

```bash [bun]
bun hardhat keystore set WALLET_PRIVATE_KEY
```

::

If you have previously used Hardhat keystore, it will ask you to enter your password.
If you haven't you will be prompted to set up a new password.

Then, input the private key for the pre-configured rich wallet we bridged funds to in the previous section:

```bash
0x7726827caac94a7f9e1b160f7ea819f172f7b6f9d2a97f992c38edeab82d4110
```

## Staking contract

Create a new file in the `contracts/contracts` folder called `Staking.sol`.

```bash
touch contracts/Staking.sol
```

Then copy and paste the staking contract:

```solidity [Staking.sol]
:code-import{filePath="interop-messages/contracts/contracts/Staking.sol"}
```

There are two functions in the staking contract: `deposit` and `withdraw`.

When a user first calls the `deposit` method, the contract sends an interop message with their encoded address.
To send the message, we use the `sendToL1` function on the `L1Messenger` contract, which is pre-deployed on every ZKsync chain at address `0x00..008008`.

The `withdraw` method simply refunds the user their deposited funds.

This contract will be deployed to multiple chains,
allowing users to choose which chain they want to stake their ETH in order to access the token reward.

## Token contract

Create a new file in the `contracts/contracts` folder called `InteropToken.sol`.

```bash
touch contracts/InteropToken.sol
```

Then copy and paste the token contract:

```solidity [InteropToken.sol]
:code-import{filePath="interop-messages/contracts/contracts/InteropToken.sol"}
```

This token contract is used to reward users for staking ETH on any of the staking contracts deployed to different chains.

In the token contract's constructor function, a list of approved staking contract addresses and their chain IDs must be defined.
We use this in the contract to make sure interop messages were sent from the correct contracts.

This contract has a mint function that takes the arguments needed for message verification.
We use the `proveL2MessageInclusionShared` method in the L2 message verification contract for verification.
This contract is deployed at `0x..10009` on each ZKsync chain.

There are a few different checks happening in the `mint` function:

1. The user has not previously claimed a reward token.
1. The interop message is verifiable.
1. The interop message was sent from an approved staking contract.
1. The interop message matches the user's address.

## Ignition scripts

Now that we have the contracts ready, let's add some ignition scripts for deploying.

### Staking ignition script

Create a new file in the `ignition/modules` folder called `Staking.ts`:

```bash
touch ignition/modules/Staking.ts
```

Then copy and paste the module below:

```ts [ignition/modules/Staking.ts]
:code-import{filePath="interop-messages/contracts/ignition/modules/Staking.ts"}
```

### Token ignition script

Create another file in the `ignition/modules` folder called `InteropToken.ts`:

```bash
touch ignition/modules/InteropToken.ts
```

Then copy and paste the module below:

```ts [ignition/modules/InteropToken.ts]
:code-import{filePath="interop-messages/contracts/ignition/modules/InteropToken.ts"}
```

## Deploying the contracts

Add some scripts to `package.json` to make it easier to compile and deploy the contracts:

```json [package.json]
"scripts": {
  "compile": "hardhat compile",
  "deploy:stakingChain1": "hardhat ignition deploy ignition/modules/Staking.ts --network stakingChain1",
  "deploy:stakingChain2": "hardhat ignition deploy ignition/modules/Staking.ts --network stakingChain2",
  "deploy:token": "hardhat ignition deploy ignition/modules/InteropToken.ts --network rewardsChain"
},
```

Now you can compile the contracts with:

::code-group

```bash [npm]
npm run compile
```

```bash [yarn]
yarn compile
```

```bash [pnpm]
pnpm compile
```

```bash [bun]
bun compile
```

::

Then deploy the staking contract to the staking chains:

::code-group

```bash [npm]
npm run deploy:stakingChain1
```

```bash [yarn]
yarn deploy:stakingChain1
```

```bash [pnpm]
pnpm deploy:stakingChain1
```

```bash [bun]
bun deploy:stakingChain1
```

::

::code-group

```bash [npm]
npm run deploy:stakingChain2
```

```bash [yarn]
yarn deploy:stakingChain2
```

```bash [pnpm]
pnpm deploy:stakingChain2
```

```bash [bun]
bun deploy:stakingChain2
```

::

### Deploy the Token Contract

Update the approved staking contract addresses in the `ignition/modules/InteropToken.ts` file.

The contract addresses can be found in your `ignition/deployments` folder in the `deployed_addresses.json` file for each chain.

Then deploy the `InteropToken` contract:

::code-group

```bash [npm]
npm run deploy:token
```

```bash [yarn]
yarn deploy:token
```

```bash [pnpm]
pnpm deploy:token
```

```bash [bun]
bun deploy:token
```

::

Now that we have all the contracts deployed, we can integrate them with the frontend in the next section.
